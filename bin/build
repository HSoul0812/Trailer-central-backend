#!/usr/bin/env bash

set -eu

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

rm -Rf laravel-nova-bd32015c9dce9060fe327f09e96abbe729900648 # just in case it exists
unzip nova.zip

docker-compose down

docker-compose up -d --build

echo "Waiting for postgres database..."
sleep 6 # this is not elegant, but it works

"$ROOT"/bin/cli composer update nothing

"$ROOT"/bin/cli php artisan migrate
"$ROOT"/bin/cli php artisan nova:publish
"$ROOT"/bin/cli php artisan optimize
"$ROOT"/bin/cli php artisan route:clear
